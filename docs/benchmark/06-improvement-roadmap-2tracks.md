# 06 -- خارطة طريق التحسين: مساران متوازيان

> تاريخ الإعداد: 2026-02-13
> المصدر: تحليل الفجوات الكمّي (codebase-analysis.md) + بحث المنافسين (research-tier1/2/3)

---

## نظرة عامة

بناءً على تحليل الفجوات بين NIT-SCS-V2 وأنظمة إدارة المستودعات والنقل الرائدة عالمياً (SAP EWM, Oracle WMS Cloud, Manhattan Active WM, Blue Yonder, Microsoft Dynamics 365, Infor WMS, Korber, Odoo, Acumatica, Fishbowl, Zoho)، تم تحديد 12 تحسيناً مرتبة في مسارين متوازيين:

- **المسار الأول:** مكاسب سريعة يمكن تنفيذها خلال 2-4 أسابيع بحد أدنى من المخاطر
- **المسار الثاني:** إعادة هيكلة بنيوية تتطلب 3-6 أشهر لتحقيق قفزة نوعية في النظام

---

## المسار الأول: مكاسب سريعة (2-4 أسابيع)

### التحسين 1: توحيد هندسة المعلومات (IA Unification)

**المشكلة:**
التنقل الحالي يعاني من تفاوت كبير بين الأدوار. دور ADMIN يحتوي على 10 أقسام مع 59 عنصراً مُنظمة في مجموعات قابلة للطي، بينما باقي الأدوار (WAREHOUSE_SUPERVISOR, MANAGER, QC_OFFICER, إلخ) تعرض 3-7 عناصر في قائمة مسطحة بدون تصنيف. هذا التفاوت يخالف نمط التصميم المعتمد في جميع أنظمة Tier 1 (SAP Fiori Launchpad, Oracle Fusion Workspace, NetSuite Dashboard) حيث يحصل كل دور على تنقل مصنّف ومرتّب حسب سياق العمل.

بالإضافة لذلك، لا يوجد نظام Breadcrumbs في أي صفحة من صفحات النظام الـ93، مما يفقد المستخدم سياق موقعه داخل التطبيق.

**الحل المقترح:**
1. إضافة أقسام قابلة للطي (collapsible sections) لجميع أدوار غير ADMIN في `navigation.ts`
2. تنفيذ Breadcrumbs عبر مكوّن `Breadcrumbs.tsx` يُدمج في `MainLayout.tsx`
3. تصنيف العناصر حسب سياق العمل (مثلاً: WAREHOUSE_SUPERVISOR يرى "الاستلام"، "الصرف"، "المخزون" كأقسام)

**الأثر التجاري:**
- تحسين تجربة المستخدم لجميع الأدوار العشرة
- تقليل وقت البحث عن الوظائف بنسبة تُقدّر بـ30-40%
- مطابقة معايير التصميم في SAP Fiori و NetSuite

**الأثر التقني:**
- تعديل `packages/frontend/src/config/navigation.ts` لإعادة هيكلة بيانات التنقل لكل دور
- تعديل `MainLayout.tsx` لدعم العرض المُجمّع و Breadcrumbs
- إنشاء مكوّن `Breadcrumbs.tsx` في `packages/frontend/src/components/`

**المخاطر:** منخفضة -- تغييرات في الواجهة فقط، لا تؤثر على البيانات أو المنطق الخلفي

**الجهد:** S (1-2 أيام)

**المالك:** Frontend Developer

**معايير القبول:**
- [ ] جميع الأدوار العشرة تعرض تنقلاً مُصنّفاً في أقسام قابلة للطي
- [ ] Breadcrumbs تظهر في جميع الصفحات الـ93
- [ ] Breadcrumbs تعكس المسار الهرمي الحقيقي (مثل: الرئيسية > المستودعات > استلام البضائع > GRN-2026-0042)
- [ ] لا يوجد تراجع في أداء التنقل أو زمن التحميل

---

### التحسين 2: نموذج التقارير التشغيلية (Operational Report Standardization)

**المشكلة:**
النظام يحتوي على Report Builder قوي ومرن (ReportBuilderPage.tsx مع 4 مكوّنات فرعية + SavedReport model)، لكن لا توجد قوالب تقارير جاهزة للاستخدام التشغيلي اليومي. في المقابل، SAP EWM يوفر 465+ تقريراً قياسياً، وNetSuite يقدم 75+ KPI مُعدّة مسبقاً. المستخدم الحالي يضطر لبناء كل تقرير من الصفر.

**الحل المقترح:**
1. إنشاء 15-20 قالب تقرير مُعدّ مسبقاً يغطي السيناريوهات الأكثر شيوعاً:
   - تقرير حركة المخزون اليومي (Daily Inventory Movement)
   - تقرير GRN الأسبوعي (Weekly GRN Summary)
   - تقرير MI/MR الشهري (Monthly Issuance/Requisition)
   - تقرير استثناءات SLA (SLA Exception Report)
   - تقرير المواد الراكدة (Non-Moving Materials)
   - تقرير أداء الموردين (Supplier Performance)
   - تقرير التحقق الجودة (QCI Summary)
   - تقرير الشحنات المتأخرة (Overdue Shipments)
2. حفظ القوالب كـ `SavedReport` records قابلة للنسخ والتعديل
3. إضافة صفحة "مكتبة القوالب" (Report Template Library) في التنقل

**الأثر التجاري:**
- تقليل وقت إعداد التقارير من 15-30 دقيقة إلى 1-2 دقيقة
- توحيد التقارير عبر جميع المشاريع والأقسام
- تمكين المدراء من الحصول على بيانات تشغيلية فورية

**الأثر التقني:**
- إنشاء seed script لقوالب التقارير (`seed-report-templates.ts`)
- تعديل `ReportBuilderPage.tsx` لإضافة استيراد القوالب
- إنشاء مكوّن `ReportTemplateLibrary.tsx`

**المخاطر:** منخفضة -- إضافة بيانات seed فقط

**الجهد:** M (3-5 أيام)

**المالك:** Full-Stack Developer

**معايير القبول:**
- [ ] 15+ قالب تقرير جاهز للاستخدام
- [ ] كل قالب يتضمن وصفاً ومعاينة
- [ ] المستخدم يمكنه نسخ القالب وتخصيصه
- [ ] القوالب تعمل مع data sources الموجودة الـ25

---

### التحسين 3: تحسين لوحة الاستثناءات (Exception Dashboard Enhancement)

**المشكلة:**
لا يوجد لوحة استثناءات مخصصة في النظام. جميع أنظمة Tier 1 تقدم Exception Queue كميزة أساسية: SAP EWM يجمع المهام المتعطلة والطلبات المتأخرة وتنبيهات السعة في Warehouse Monitor مع إجراءات بنقرة واحدة. Oracle Fusion WM يستخدم AI Agents لتحديد الاستثناءات تلقائياً. النظام الحالي يعرض KPIs إجمالية لكن لا يُبرز الانحرافات أو المشاكل التي تتطلب تدخلاً فورياً.

**الحل المقترح:**
1. إنشاء `ExceptionDashboard.tsx` في `pages/dashboards/`
2. عرض 5 طوابير استثناء:
   - المهام المتأخرة (Overdue Tasks) -- من Task model
   - المستندات المتعطلة (Stuck Documents) -- مستندات لم تتغير حالتها لأكثر من X أيام
   - انتهاكات SLA (SLA Breaches) -- من JoSlaTracking
   - مواد منخفضة المخزون (Low Stock Alerts) -- من InventoryLevel
   - موافقات معلّقة (Pending Approvals) -- من ApprovalStep
3. إضافة إجراءات سريعة (Quick Actions) لكل استثناء: تصعيد، إعادة تعيين، إغلاق

**الأثر التجاري:**
- كشف المشاكل التشغيلية قبل أن تتفاقم
- تقليل وقت الاستجابة للاستثناءات بنسبة 50-70%
- تحسين الامتثال لاتفاقيات مستوى الخدمة (SLA)

**الأثر التقني:**
- إنشاء مكوّن `ExceptionDashboard.tsx` مع 5 طوابير
- إضافة endpoints جديدة في backend: `GET /api/v1/dashboard/exceptions`
- إضافة widget data sources جديدة في `widget-data.service.ts`

**المخاطر:** منخفضة إلى متوسطة -- يتطلب queries جديدة على قاعدة البيانات يجب مراقبة أدائها

**الجهد:** M (3-5 أيام)

**المالك:** Full-Stack Developer

**معايير القبول:**
- [ ] 5 طوابير استثناء تعمل مع بيانات حية
- [ ] كل استثناء يعرض: النوع، التاريخ، المسؤول، الأولوية، إجراء سريع
- [ ] تحديث فوري عبر Socket.IO
- [ ] إمكانية تخصيص عتبات التنبيه (مثلاً: مستند متعطل بعد 3 أيام vs 7 أيام)

---

### التحسين 4: تأمين صلاحيات الوحدات الديناميكية/AI

**المشكلة:**
منصة التطوير الذاتي (Dynamic Document Types, Custom Data Sources, Custom Fields) ووحدة AI تفتقر إلى صلاحيات RBAC دقيقة على مستوى الموارد. حالياً، أي مستخدم لديه وصول إلى المسارات يمكنه إنشاء/تعديل/حذف أنواع مستندات ديناميكية أو مصادر بيانات مخصصة. هذا يشكل ثغرة أمنية خاصة أن هذه الميزات تتفاعل مع نموذج البيانات مباشرة (ENTITY_MODEL_MAP: 23 كيان → Prisma models).

**الحل المقترح:**
1. إضافة 5 موارد جديدة إلى مصفوفة RBAC: `dynamic_types`, `custom_data_sources`, `custom_fields`, `workflow_templates`, `ai_chat`
2. تطبيق middleware `requirePermission` على routes الجديدة
3. إضافة rate limiting لوحدة AI (مثل: 30 طلب/ساعة لكل مستخدم)
4. إضافة input validation أقوى لـ AI chat (SQL injection prevention)

**الأثر التجاري:**
- حماية البيانات من التعديل غير المصرّح به
- الامتثال لمتطلبات الأمان المؤسسية
- تقليل مخاطر إساءة استخدام وحدة AI

**الأثر التقني:**
- تعديل `packages/shared/src/permissions.ts` لإضافة الموارد الجديدة
- تعديل 7 ملفات routes (dynamic-document-type, dynamic-document, custom-data-source, custom-fields, workflow-template, ai, ai-suggestions)
- تعديل `permission.service.ts` لدعم الموارد الجديدة

**المخاطر:** منخفضة -- إضافة طبقة أمان فوق بنية موجودة

**الجهد:** S (1-2 أيام)

**المالك:** Backend Developer

**معايير القبول:**
- [ ] جميع routes الديناميكية محمية بـ RBAC
- [ ] ADMIN فقط يمكنه إنشاء/تعديل/حذف Dynamic Types و Custom Data Sources
- [ ] AI chat محدد بـ30 طلب/ساعة لكل مستخدم
- [ ] جميع مدخلات AI chat تمر عبر validation محسّن
- [ ] اختبارات unit tests للصلاحيات الجديدة

---

### التحسين 5: عروض محفوظة للمستخدمين (User Saved Views)

**المشكلة:**
يوجد نموذج `UserView` في Prisma schema و hook `useUserViews` في الواجهة، لكن الاستخدام الفعلي محدود. لا يمكن للمستخدم حفظ عرض مخصص لجداول البيانات (AG Grid) أو لوحات المعلومات بسهولة. في SAP Fiori، "My Views" و variant management هي ميزة أساسية في كل شاشة. في NetSuite، saved search variants قابلة للمشاركة بين المستخدمين.

**الحل المقترح:**
1. توسيع نموذج `UserView` ليشمل: تكوين الأعمدة، الفلاتر، الترتيب، حجم الصفحة
2. إضافة مكوّن `SavedViewSelector.tsx` في شريط أدوات SmartGrid
3. إتاحة حفظ/تحميل/مشاركة العروض في جميع صفحات القوائم
4. دعم العروض الافتراضية لكل دور (Role Default Views)

**الأثر التجاري:**
- تقليل وقت إعداد طريقة العرض من دقائق إلى ثوانٍ
- توحيد طريقة عرض البيانات عبر الفريق
- تحسين رضا المستخدم من خلال تخصيص التجربة

**الأثر التقني:**
- تعديل `UserView` Prisma model لإضافة حقول التكوين
- إنشاء `SavedViewSelector.tsx` في `components/smart-grid/`
- تعديل `SmartGrid.tsx` لدمج المكوّن الجديد
- تعديل `user-view.routes.ts` لدعم CRUD الكامل

**المخاطر:** منخفضة

**الجهد:** M (3-5 أيام)

**المالك:** Full-Stack Developer

**معايير القبول:**
- [ ] المستخدم يمكنه حفظ عرض مخصص باسم وصفي
- [ ] المستخدم يمكنه تحميل عرض محفوظ بنقرة واحدة
- [ ] دعم مشاركة العروض (عام/خاص)
- [ ] دعم العروض الافتراضية لكل دور
- [ ] لا يوجد تراجع في أداء SmartGrid

---

### التحسين 6: Drill-down من KPI إلى المعاملة

**المشكلة:**
بطاقات KPI في جميع Dashboards الـ18 (10 خاصة بالأدوار + 8 متخصصة) تعرض أرقاماً إجمالية (مثل: "12 موافقة معلّقة") بدون رابط للتفاصيل. في SAP EWM، يتبع التصميم نمط 3 مستويات: KPI Tile → Monitor (قائمة مفلترة) → Transaction Detail. هذا النمط معتمد أيضاً في NetSuite و Oracle Fusion و Manhattan Active.

**الحل المقترح:**
1. إضافة `onClick` handler لجميع مكوّنات `KpiCard`
2. ربط كل KPI بمسار navigation مفلتر (مثل: "12 موافقة معلّقة" → `/admin/pending-approvals?status=pending`)
3. إضافة دعم query parameters للفلترة في صفحات القوائم

**الأثر التجاري:**
- تحسين سرعة الوصول إلى التفاصيل بنسبة 80%
- تحويل الأرقام إلى معلومات قابلة للتنفيذ (actionable data)
- مطابقة نمط Drill-down المعتمد عالمياً

**الأثر التقني:**
- تعديل `KpiCard.tsx` لدعم `onClick` و `href` props
- تعديل صفحات Dashboards لتمرير روابط الـ drill-down
- تعديل صفحات القوائم لقراءة query parameters وتطبيق الفلاتر تلقائياً

**المخاطر:** منخفضة -- تغييرات واجهة فقط

**الجهد:** S (1-2 أيام)

**المالك:** Frontend Developer

**معايير القبول:**
- [ ] جميع KPI cards في Dashboards الـ18 قابلة للنقر
- [ ] النقر على KPI ينتقل إلى قائمة مفلترة ذات صلة
- [ ] الفلتر يُطبّق تلقائياً عند وصول المستخدم للصفحة المستهدفة
- [ ] دعم زر "العودة" في المتصفح

---

## المسار الثاني: إعادة هيكلة بنيوية (3-6 أشهر)

### التحسين 7: خدمة تنقل ديناميكية (Dynamic Navigation Service)

**المشكلة:**
التنقل الحالي مُعرّف بالكامل في ملف ثابت (`navigation.ts`) مع بيانات hardcoded لكل دور. أي تغيير في بنية التنقل يتطلب تعديل الكود وإعادة النشر. أنظمة Tier 1 مثل SAP Fiori و Oracle Fusion تستخدم خدمات تنقل ديناميكية تُحدّث من قاعدة البيانات وتأخذ بعين الاعتبار الصلاحيات الفعلية.

**الحل المقترح:**
1. إنشاء endpoint جديد: `GET /api/v1/navigation` يُرجع قائمة تنقل مبنية على:
   - دور المستخدم الحالي
   - الصلاحيات الفعلية (من RolePermission + DB overrides)
   - تكوين الأقسام النشطة (من SystemSetting)
   - Dynamic Document Types المُفعّلة
2. إنشاء نموذج `NavigationItem` في Prisma schema
3. تعديل الواجهة لجلب التنقل من API بدلاً من الملف الثابت
4. إتاحة تخصيص التنقل من لوحة الإعدادات

**الأثر التجاري:**
- تمكين المسؤولين من تخصيص التنقل بدون تعديل الكود
- إخفاء الأقسام غير المُفعّلة تلقائياً
- دمج الأنواع الديناميكية في التنقل بسلاسة
- تقليل وقت النشر عند تغيير هيكل التنقل

**الأثر التقني:**
- إنشاء `navigation.service.ts` و `navigation.routes.ts` في backend
- إنشاء نموذج Prisma جديد `NavigationItem`
- تعديل `MainLayout.tsx` و `Sidebar.tsx` لاستخدام API
- إنشاء صفحة إعدادات التنقل في لوحة الإدارة

**المخاطر:** متوسطة -- يجب الحفاظ على التوافق مع التنقل الحالي أثناء الانتقال

**الجهد:** L (2-3 أسابيع)

**المالك:** Full-Stack Developer (Senior)

**معايير القبول:**
- [ ] التنقل يُجلب من API مع caching (5 دقائق)
- [ ] المسؤول يمكنه إعادة ترتيب/إخفاء/إظهار عناصر التنقل من UI
- [ ] الأنواع الديناميكية تظهر تلقائياً في التنقل عند تفعيلها
- [ ] Fallback إلى التنقل الثابت في حالة فشل API
- [ ] اختبارات تغطي جميع الأدوار العشرة

---

### التحسين 8: محرك حالة موحد (Unified State Engine)

**المشكلة:**
النظام يستخدم محرك حالة (State Machine) في `packages/shared` مع STATUS_FLOWS مُعرّفة في `formConfigs.ts` لـ15 نوع مستند. لكن كل خدمة backend تنفّذ منطق الانتقال بشكل مستقل (if/else chains) مع side effects مُبعثرة عبر 22 خدمة مستند. SAP EWM يستخدم POSC/LOSC كمحرك قواعد موحد، و Manhattan Active يستخدم rules engine مركزي. توحيد المحرك يقلل التكرار ويُسهّل إضافة أنواع مستندات جديدة.

**الحل المقترح:**
1. إنشاء `StateEngine` مركزي يتعامل مع:
   - تعريفات الحالة والانتقالات من قاعدة البيانات (DB-configurable)
   - Guards (شروط قبل الانتقال): مثل التحقق من الصلاحيات، التحقق من البيانات
   - Side Effects (إجراءات بعد الانتقال): مثل إنشاء مستند تابع، إرسال إشعار
   - Hooks (before/after transition)
2. ترحيل الـ15 نوع مستند تدريجياً من المنطق المُبعثر إلى StateEngine
3. إتاحة تعديل التدفقات من UI بدون تعديل الكود

**الأثر التجاري:**
- تقليل وقت إضافة نوع مستند جديد من أيام إلى ساعات
- تقليل الأخطاء الناتجة عن تكرار المنطق
- تمكين المسؤولين من تعديل تدفقات العمل بدون مطوّرين

**الأثر التقني:**
- إنشاء `state-engine.service.ts` مع نموذج `StateTransition` في Prisma
- إنشاء `state-guard.service.ts` و `state-effect.service.ts`
- ترحيل تدريجي لـ22 خدمة مستند
- تكامل مع Workflow Engine الموجود

**المخاطر:** عالية -- يتطلب ترحيلاً تدريجياً بعناية مع اختبارات regression شاملة

**الجهد:** XL (4-6 أسابيع)

**المالك:** Backend Architect

**معايير القبول:**
- [ ] StateEngine يدعم جميع الـ15 نوع مستند الحالية
- [ ] Guards و Side Effects قابلة للتكوين من DB
- [ ] ترحيل ناجح لـ3 أنواع مستندات على الأقل كإثبات مفهوم
- [ ] لا يوجد تراجع في أداء أو وظائف الأنواع الحالية
- [ ] اختبارات integration tests لكل نوع مستند

---

### التحسين 9: وقت تشغيل مستند موحد (Unified Document Runtime)

**المشكلة:**
حالياً يوجد 37 صفحة form في `pages/` root + 8 في `pages/forms/`، كل منها يُنفّذ عرض المستند بشكل مستقل باستخدام `useDocumentForm` hook و `formConfigs.ts`. رغم وجود أنماط مشتركة (header + line items + status flow + actions + comments)، إلا أن كل نموذج يكتب layout الخاص به. NetSuite يستخدم record type renderer موحد، و Manhattan Active يستخدم document runtime مُعدّ بالتكوين.

**الحل المقترح:**
1. إنشاء مكوّن `DocumentRuntime.tsx` موحد يعرض:
   - Header Section (تلقائي من form config)
   - Line Items Table (تلقائي إذا كان النوع يدعم line items)
   - Status Flow (تلقائي من STATUS_FLOWS)
   - Action Buttons (تلقائي من الحالة الحالية + الصلاحيات)
   - Comments Section (تلقائي)
   - Attachments Section (تلقائي)
   - Custom Fields Section (تلقائي إذا مُفعّل)
2. توسيع `formConfigs.ts` ليشمل layout configuration
3. ترحيل تدريجي للنماذج الموجودة إلى DocumentRuntime

**الأثر التجاري:**
- توحيد تجربة المستخدم عبر جميع أنواع المستندات
- تقليل وقت تطوير نوع مستند جديد بنسبة 70-80%
- تسهيل الصيانة والتحديثات

**الأثر التقني:**
- إنشاء `DocumentRuntime.tsx` في `components/`
- توسيع `FormSectionConfig` type
- ترحيل تدريجي لـ45 صفحة form
- تكامل مع Dynamic Document Types الموجودة

**المخاطر:** عالية -- يجب الحفاظ على التوافق مع النماذج المخصصة (JO sub-types)

**الجهد:** XL (6-8 أسابيع)

**المالك:** Frontend Architect

**معايير القبول:**
- [ ] DocumentRuntime يعرض جميع الـ15 نوع مستند بدون فقدان وظائف
- [ ] JO sub-types (7 أنواع) مدعومة عبر dynamic sections
- [ ] أنواع المستندات الديناميكية تعمل عبر DocumentRuntime
- [ ] ترحيل ناجح لـ5 أنواع على الأقل كإثبات مفهوم
- [ ] اختبارات E2E لكل نوع مستند

---

### التحسين 10: طبقة تحليلات دلالية (Semantic Analytics Layer)

**المشكلة:**
النظام يوفر 25 مصدر بيانات مسجل في `widget-data.service.ts`، لكنها تُعيد بيانات خام بتنسيقات مختلفة. لا توجد طبقة دلالية موحدة تعرّف المقاييس (measures) والأبعاد (dimensions) والفلاتر بشكل مركزي. SAP يستخدم CDS views مع semantic annotations، و NetSuite يستخدم SuiteAnalytics مع saved searches، و Infor يستخدم Birst كطبقة BI مدمجة.

**الحل المقترح:**
1. إنشاء Semantic Layer يعرّف:
   - Measures: القيم الرقمية (مثل: عدد المستندات، قيمة المخزون، متوسط زمن المعالجة)
   - Dimensions: أبعاد التحليل (مثل: المشروع، المستودع، الفترة الزمنية، النوع)
   - Filters: فلاتر قابلة للتطبيق (مثل: التاريخ، الحالة، الدور)
2. إنشاء `analytics.service.ts` يُنفّذ queries ديناميكية بناءً على الطبقة الدلالية
3. تحديث Dashboard Builder و Report Builder لاستخدام الطبقة الجديدة

**الأثر التجاري:**
- تمكين إنشاء تقارير مخصصة بدون معرفة تقنية
- توحيد تعريف المقاييس عبر جميع التقارير ولوحات المعلومات
- إمكانية Cross-report drilling

**الأثر التقني:**
- إنشاء `semantic-layer.service.ts` مع نماذج Measure/Dimension/Filter
- تعديل `widget-data.service.ts` لاستخدام الطبقة الجديدة
- تعديل Dashboard Builder و Report Builder components

**المخاطر:** متوسطة -- يتطلب تصميماً دقيقاً للطبقة الدلالية وأداء queries

**الجهد:** L (3-4 أسابيع)

**المالك:** Backend Architect + Data Engineer

**معايير القبول:**
- [ ] 30+ measure و 15+ dimension معرّفة
- [ ] Dashboard Builder يستخدم الطبقة الدلالية حصرياً
- [ ] Report Builder يستخدم الطبقة الدلالية حصرياً
- [ ] أداء queries < 2 ثانية لمعظم التقارير
- [ ] اختبارات أداء لسيناريوهات بيانات كبيرة

---

### التحسين 11: إطار نماذج/تقارير موحد (Unified Form/Report Framework)

**المشكلة:**
يوجد نظامان مُنفصلان للنماذج: نظام النماذج الثابتة (45 صفحة form مكتوبة يدوياً) ونظام النماذج الديناميكية (DynamicFormRenderer مع 20+ field type). التقارير أيضاً مُنفصلة: Report Builder و Dashboard Builder. في NetSuite، يستخدم SuiteFlow نظام واحد لجميع أنواع النماذج والتقارير مع SuiteScript للتخصيص.

**الحل المقترح:**
1. إنشاء Form Runtime Engine موحد يدمج:
   - النماذج الثابتة (config-driven rendering)
   - النماذج الديناميكية (DynamicFormRenderer)
   - أنواع الحقول المشتركة (30+ field type)
2. إنشاء Report Runtime Engine موحد يدمج:
   - Report Builder
   - Dashboard Widgets
   - Custom Data Sources
3. مشاركة field type registry بين النظامين

**الأثر التجاري:**
- تجربة مستخدم موحدة لجميع النماذج والتقارير
- تقليل تكلفة الصيانة بنسبة 40-50%
- تسريع إضافة أنواع حقول جديدة

**الأثر التقني:**
- إنشاء `form-runtime.service.ts` و `report-runtime.service.ts`
- دمج DynamicFieldRenderer مع FormField component
- إنشاء shared field type registry

**المخاطر:** عالية -- تكامل معقد بين أنظمة فرعية متعددة

**الجهد:** XL (4-6 أسابيع)

**المالك:** Frontend Architect + Backend Architect

**معايير القبول:**
- [ ] Field type registry موحد يدعم 30+ نوع حقل
- [ ] النماذج الثابتة والديناميكية تُعرض عبر نفس المحرك
- [ ] Report Builder و Dashboard Builder يتشاركان مكوّنات العرض
- [ ] ترحيل ناجح لـ3 نماذج و 3 تقارير كإثبات مفهوم

---

### التحسين 12: نظام إدارة النقل (TMS Module)

**المشكلة:**
النظام يحتوي على إدارة أوامر عمل النقل (Job Orders) مع 7 أنواع فرعية، وإدارة Gate Passes، وتتبع الشحنات. لكنه يفتقر إلى قدرات TMS حقيقية مثل: إدارة الناقلين (Carrier Management)، تحسين التحميل (Load Optimization)، تدقيق الشحن (Freight Audit)، وتتبع GPS الفوري. SAP TM و Oracle OTM و Manhattan Active TM و Blue Yonder TMS جميعها توفر هذه القدرات كميزات أساسية.

**الحل المقترح:**
1. **إدارة الناقلين (Carrier Management):**
   - نموذج Carrier في Prisma (اسم، نوع، عقود، أسعار، تقييم أداء)
   - CRUD + بطاقة أداء الناقل (Carrier Scorecard)
2. **تحسين التحميل (Load Optimization):**
   - خوارزمية bin-packing لتعظيم استخدام المركبات
   - مراعاة الوزن/الحجم/التوافق
3. **تدقيق الشحن (Freight Audit):**
   - مطابقة فواتير الناقلين مع الأسعار المتعاقد عليها
   - تقرير الفروقات
4. **تتبع GPS:**
   - تكامل مع Telematics APIs
   - تحديث حالة الشحنة تلقائياً بناءً على الموقع

**الأثر التجاري:**
- توفير 10-15% من تكاليف النقل (بناءً على benchmarks Microsoft D365 TM)
- تحسين الرؤية الفورية لسلسلة التوريد
- تقليل أخطاء الفوترة مع الناقلين

**الأثر التقني:**
- إنشاء 4+ نماذج Prisma جديدة (Carrier, CarrierRate, FreightInvoice, FreightAudit)
- إنشاء 4+ خدمات backend جديدة
- إنشاء 3+ صفحات frontend جديدة
- تكامل مع Job Order و Shipment الموجودين

**المخاطر:** عالية -- وحدة جديدة كلياً تتطلب تصميماً وتنفيذاً واختباراً شاملاً

**الجهد:** XL (6-8 أسابيع)

**المالك:** Backend Architect + Full-Stack Developer (Senior)

**معايير القبول:**
- [ ] CRUD كامل لإدارة الناقلين مع بطاقات أداء
- [ ] خوارزمية Load Optimization تعمل مع بيانات حقيقية
- [ ] Freight Audit يكشف فروقات > 5% تلقائياً
- [ ] تكامل مع Job Order flow الحالي بدون كسر الوظائف الموجودة
- [ ] 50+ اختبار unit tests للوحدة الجديدة

---

## ملخص المقارنة

### الجهد والأولوية

| # | التحسين | المسار | الجهد | الأولوية | الأثر التجاري |
|---|---------|--------|-------|----------|---------------|
| 1 | توحيد هندسة المعلومات | الأول | S | P0 | عالي |
| 2 | قوالب التقارير التشغيلية | الأول | M | P1 | متوسط-عالي |
| 3 | لوحة الاستثناءات | الأول | M | P1 | عالي |
| 4 | تأمين صلاحيات الوحدات الديناميكية | الأول | S | P0 | حرج (أمني) |
| 5 | عروض محفوظة | الأول | M | P1 | متوسط |
| 6 | Drill-down من KPI | الأول | S | P1 | متوسط-عالي |
| 7 | خدمة تنقل ديناميكية | الثاني | L | P2 | متوسط |
| 8 | محرك حالة موحد | الثاني | XL | P2 | عالي |
| 9 | وقت تشغيل مستند موحد | الثاني | XL | P2 | عالي |
| 10 | طبقة تحليلات دلالية | الثاني | L | P2 | متوسط-عالي |
| 11 | إطار نماذج/تقارير موحد | الثاني | XL | P2 | متوسط |
| 12 | نظام إدارة النقل | الثاني | XL | P2 | عالي |

### مقياس الجهد

| الرمز | المعنى | المدة التقديرية |
|-------|--------|----------------|
| S | صغير | 1-2 أيام |
| M | متوسط | 3-5 أيام |
| L | كبير | 2-3 أسابيع |
| XL | كبير جداً | 4-8 أسابيع |

### مخطط التنفيذ المقترح

```
الأسبوع 1-2 (المسار الأول - S items):
  ├── التحسين 1: توحيد IA + Breadcrumbs
  ├── التحسين 4: تأمين RBAC
  └── التحسين 6: KPI Drill-down

الأسبوع 2-4 (المسار الأول - M items):
  ├── التحسين 2: قوالب التقارير
  ├── التحسين 3: لوحة الاستثناءات
  └── التحسين 5: عروض محفوظة

الشهر 2-3 (المسار الثاني - L items):
  ├── التحسين 7: خدمة تنقل ديناميكية
  └── التحسين 10: طبقة تحليلات دلالية

الشهر 3-6 (المسار الثاني - XL items):
  ├── التحسين 8: محرك حالة موحد
  ├── التحسين 9: وقت تشغيل مستند موحد
  ├── التحسين 11: إطار نماذج موحد
  └── التحسين 12: نظام إدارة النقل (TMS)
```

---

> **ملاحظة:** يمكن تنفيذ تحسينات المسار الأول بالتوازي بين مطوّرين متعددين. تحسينات المسار الثاني تتطلب ترتيباً: يُفضّل البدء بالتحسين 8 (محرك الحالة) قبل التحسين 9 (وقت تشغيل المستند)، وبالتحسين 10 (الطبقة الدلالية) قبل التحسين 11 (إطار التقارير).
